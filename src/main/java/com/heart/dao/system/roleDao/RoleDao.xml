<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.heart.dao.system.roleDao.RoleDao">

    <select id="loadRoleById" resultType="com.heart.dto.system.role.RoleDto">
        select r.roleid,r.rolename,r.roledesc from role_t as r where r.roleid = #{roleid}
    </select>

    <select id="loadRoleList" parameterType="com.heart.dto.system.role.RoleDto" resultType="com.heart.dto.system.role.RoleDto">
        select r.roleid,r.rolename,r.roledesc from role_t as r where 1=1
        order by r.roleid desc
    </select>

    <insert id="addRole" parameterType="com.heart.dto.system.role.RoleDto">
        insert into role_t(roleid,rolename,roledesc) values(#{roleid},#{rolename},#{roledesc})
    </insert>

    <insert id="addRoleFunction" parameterType="com.heart.dto.system.role.RoleFunctionDto">
        insert into role_function_t(roleid,functionid) values(#{roleid},#{functionid})
    </insert>

    <delete id="deleteRoleById">
        delete from role_t where roleid = #{roleid}
    </delete>

    <delete id="deleteRoleFunctionById">
        delete from role_function_t where roleid = #{roleid}
    </delete>

    <update id="updateRole" parameterType="com.heart.dto.system.role.RoleDto">
        update role_t set rolename = #{rolename},roledesc = #{roledesc} where roleid = #{roleid}
    </update>

    <select id="hasUserInRole" resultType="Integer">
        select count(1) from user_t as u where u.roleid = #{roleid}
    </select>

    <select id="hasSameRoleName"  resultType="Integer">
        select count(1) from role_t as r where r.rolename = #{rolename} and r.roleid != #{roleid}
    </select>

</mapper>